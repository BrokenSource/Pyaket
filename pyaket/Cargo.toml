# ---------------------------------------------------------------------------- #

[package]
name          = "pyaket"
version       = "0.10.0"
authors       = ["Tremeschin"]
description   = "ðŸ“¦ Easy Python to Fast Executables"
repository    = "https://github.com/BrokenSource/Pyaket"
documentation = "https://pyaket.dev/docs/"
homepage      = "https://pyaket.dev/"
readme        = "../.github/readme.md"
license       = "AGPL-3.0"
edition       = "2024"

[workspace]
resolver = "3"

# ---------------------------------------------------------------------------- #

[lib]
name = "pyaket"
path = "pyaket/lib.rs"

[[bin]]
name = "pyaket"
path = "pyaket/main.rs"

# ---------------------------------------------------------------------------- #

[dependencies]
anyhow        = {version="1.0.100"}
bzip2         = {version="0.6.1", optional=true}
clap          = {version="4.5.51", features=["derive"]}
directories   = {version="6.0.0"}
dotenvy       = {version="0.15.7"}
flate2        = {version="1.1.5", optional=true}
glob          = {version="0.3.3"}
rust-embed    = {version="8.9.0", features=["interpolate-folder-path"]}
serde         = {version="1.0.228", features=["derive"]}
serde_json    = {version="1.0.145"}
shlex         = {version="1.3.0"}
smart-default = {version="0.7.1"}
tar           = {version="0.4.44"}
temp-dir      = {version="0.1.16"}
ureq          = {version="3.1.4"}
uuid          = {version="1.18.1", features=["v4"]}
xxhash-rust   = {version="0.8.15", features=["xxh3"]}
zip           = {version="6.0.0", features=["deflate"], default-features=false, optional=true}
zstd          = {version="0.13.3", optional=true}

[build-dependencies]
anyhow        = {version="1.0.100"}
bzip2         = {version="0.6.1", optional=true}
clap          = {version="4.5.51", features=["derive"]}
directories   = {version="6.0.0"}
dotenvy       = {version="0.15.7"}
flate2        = {version="1.1.5", optional=true}
glob          = {version="0.3.3"}
rust-embed    = {version="8.9.0", features=["interpolate-folder-path"]}
serde         = {version="1.0.228", features=["derive"]}
serde_json    = {version="1.0.145"}
shlex         = {version="1.3.0"}
smart-default = {version="0.7.1"}
tar           = {version="0.4.44"}
temp-dir      = {version="0.1.16"}
ureq          = {version="3.1.4"}
uuid          = {version="1.18.1", features=["v4"]}
xxhash-rust   = {version="0.8.15", features=["xxh3"]}
winresource   = {version="0.1.27", default-features=false}
zip           = {version="6.0.0", features=["deflate"], default-features=false, optional=true}
zstd          = {version="0.13.3", optional=true}

# ---------------------------------------------------------------------------- #

[features]
default = [
    "gzip",
    "zip",
    "zstd",
]

# Archive formats
bzip    = ["dep:bzip2"]
gzip    = ["dep:flate2"]
zip     = ["dep:zip"]
zstd    = ["dep:zstd"]

[lints.rust]
unexpected_cfgs = {level="warn", check-cfg=["cfg(runtime)", "cfg(rust_analyzer)"]}

# ---------------------------------------------------------------------------- #

[profile.develop]
inherits = "dev"
opt-level = 1
panic = "abort"
strip = true

[profile.dev]
panic = "abort" # Still shows panic message, skips unwinding
strip = true    # Saves disk writes at no worse compile time

[profile.release]
codegen-units = 1  # Slightly improves binary size at no worse compile time
incremental = true # Faster recompilation times for iterative development
opt-level = 3      # Microseconds matter in production, space is plenty
panic = "abort"    # Still shows panic message, skips unwinding
lto = false        # Annoyingly slow linking times for minor size reduction

# About 5x slower to build the final binary, for about 15%
# size reduction, but 35% slower decompression and hashing
[profile.small]
inherits = "release"
opt-level = "z"
lto = true
